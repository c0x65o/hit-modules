Metadata-Version: 2.4
Name: hit-modules
Version: 1.0.2
Summary: Shared middleware utilities for HIT microservices
Author-email: HIT Platform <platform@hitlabs.dev>
Requires-Python: >=3.11
Description-Content-Type: text/markdown
Requires-Dist: requests>=2.31.0
Requires-Dist: pydantic>=2.0.0
Requires-Dist: python-jose>=3.3.0
Requires-Dist: fastapi>=0.110.0
Requires-Dist: uvicorn>=0.23.0
Provides-Extra: sqlalchemy
Requires-Dist: SQLAlchemy>=2.0.0; extra == "sqlalchemy"
Provides-Extra: dev
Requires-Dist: pytest>=7.4.0; extra == "dev"
Requires-Dist: httpx>=0.26.0; extra == "dev"

# hit-modules

Shared client-side utilities for HIT microservices. This repo contains:

- **Python client library** (`python/hit_modules`) for modules to:
  - Fetch secrets/tokens from the provisioner service
  - Get module configuration from `hit.yaml` via the provisioner
  - Connect to databases using provisioner-managed secrets
  - Enforce authentication via bearer tokens
  - Standardize version detection and logging

## Client Usage

Modules use `hit-modules` to interact with the provisioner service:

```python
from hit_modules.auth import enforce_fastapi_auth
from hit_modules.middleware import get_module_config
from hit_modules.version import get_module_version, log_module_startup

# Enforce bearer token auth on all routes
enforce_fastapi_auth(app)

# Get module config from hit.yaml (injected as FastAPI dependency)
@app.get("/endpoint")
def my_endpoint(config: dict[str, Any] = Depends(get_module_config)):
    increment = config.get("settings", {}).get("increment", 1)
    ...

# Get version and log startup
__version__ = get_module_version(module_name="my-module")
log_module_startup(module_name="my-module", version=__version__)
```

## Provisioner Service

The provisioner server is in a separate repository: [`hit-module-provisioner`](https://github.com/c0x65o/hit-module-provisioner)

## Tests

```
uv run --extra dev pytest
```
